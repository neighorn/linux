#! /bin/sh
while ps -ef | grep dirvish | grep -qv grep
do
	now=`date +%T`
	ps -ef |
	grep rsync |
	grep -v grep |
	while read trash pid trash
	do
		lsof -p $pid
	done |
	grep tree/ |
	while read trash trash trash fh trash trash trash trash filename
	do
		[[ $fh = [0-9]*r ]] || continue		# Filter out output file.
		echo $now $filename
	done |
	sort
	sleep 30
done
date '+No dirvish processes running at %T'

